From: Chris Renshaw <osm0sis@outlook.com>
Date: Thu, 3 Dec 2015 13:49:01 -0400
Subject: [PATCH] depmod: fix syntax with modules in parameter

Patch by Tanguy Pruvot <tanguy.pruvot@gmail.com>
Change-Id: I21b8664db01cf0132db82f8d6caa1a0e77e71004
from https://github.com/tpruvot/android_external_busybox
Rebased for busybox 1.24.1 by Chris Renshaw <osm0sis@outlook.com>
---
 modutils/depmod.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/modutils/depmod.c b/modutils/depmod.c
index 9713aef..4050494 100644
--- a/modutils/depmod.c
+++ b/modutils/depmod.c
@@ -49,7 +49,10 @@ static int FAST_FUNC parse_module(const char *fname, struct stat *sb UNUSED_PARA
 	*first = info;
 
 	info->dnext = info->dprev = info;
-	info->name = xstrdup(fname + 2); /* skip "./" */
+	if (strncmp(fname, "./", 2) == 0)
+		info->name = xstrdup(fname + 2);
+	else
+		info->name = xstrdup(fname);
 	info->modname = filename2modname(
 			bb_get_last_path_component_nostrip(fname),
 			NULL
-- 
2.5.3

